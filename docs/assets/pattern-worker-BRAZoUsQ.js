let c=null,f=null,p=null,i=null,l=!1;async function g(){if(!l)try{const e=await import(new URL("../wasm/crochet_wasm.js",import.meta.url).href);await e.default(),c=e.generate_pattern_from_json,f=e.validate_profile,p=e.validate_config,i=e.init_panic_hook,i&&i(),l=!0}catch(t){throw console.error("WASM initialization failed:",t),new Error(`Failed to initialize WASM: ${t.message}`)}}self.onmessage=async t=>{const{id:e,type:n,payload:o}=t.data;try{switch(await g(),n){case"GENERATE_PATTERN":{const{profile:a,config:r}=o;try{const s=c(JSON.stringify(a),JSON.stringify(r)),y=JSON.parse(s);self.postMessage({id:e,type:"SUCCESS",payload:y})}catch(s){throw new Error(`Pattern generation failed: ${s}`)}break}case"VALIDATE_PROFILE":{const r=f(JSON.stringify(o));self.postMessage({id:e,type:"SUCCESS",payload:r});break}case"VALIDATE_CONFIG":{const r=p(JSON.stringify(o));self.postMessage({id:e,type:"SUCCESS",payload:r});break}default:throw new Error(`Unknown action type: ${n}`)}}catch(a){self.postMessage({id:e,type:"ERROR",payload:a.message})}};
